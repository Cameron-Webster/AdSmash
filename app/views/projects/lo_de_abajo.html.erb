<!-- projects participants -->

<% project.project_teams.each do |x|  %>
  <%= x.user.name  %>

       <% end %>

<!-- projects participants -->

<!-- links show.... -->
<%= link_to 'Show', project %>
       <%= link_to 'Edit', edit_project_path(project) %>
       <%= link_to 'Destroy', project, method: :delete, data: { confirm: 'Are you sure?' } %>

<!-- links show.. -->

<br>


<div class="activity"><ul></ul></div>

<%= link_to 'New Project', new_project_path %>


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalLong">
  <%= link_to 'New Project', new_project_path %>
</button>



<button class="comments">submit</button><div class="out"></div>

<% content_for :after_js do %>
<script>
var activity = {};
    setInterval(function(){



          $.ajax({
            method: "GET",
            url: "<%= notifications_path %>",
            success: function (data) {

              //for activity count per project

              var projects_to_update = [];
              var counter = {};


            for (var obj in data) {
              projects_to_update.push(data[obj].notifiable)
              activity[data[obj].id] = [data[obj].notifiable, data[obj].actor, data[obj].action]
            };

            for (var i = 0; i < projects_to_update.length; i++) {
              counter[projects_to_update[i]] = counter[projects_to_update[i]] + 1 || 1
            }
              // console.log(counter)
              for(var prop in counter){
                $('.cnt' + prop).text(counter[prop])
              }

              // for(var prop in activity) {
              //   $('.activity ul').text('<li>' + activity[prop][1] + ' ' + activity[prop][2] + '</li>')
              // }



              console.log(activity);



            },
              error: function(jqXHR) {
          alert(jqXHR.responseText);
            }
          });
        }, 20000);


</script>
<% end %>

